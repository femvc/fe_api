<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Ebbinghaus Intelligent Remember [v1.0]</title>
<script type="text/javascript" src="js/hui.js"></script>
<script type="text/javascript" src="js/table.js"></script>

<link rel="stylesheet" type="text/css" href="css/main.css">

<style>
.hui_checkbox{float:left;}
.hui_radioinput{float:left;padding-right:23px;cursor:pointer;}
.hui_radioinput .hui_radioinput_input{display:none;}
.hui_radioinput .hui_radioinput_icon{background-image:url(/static/img/hui_radioinput.png);background-repeat:no-repeat;background-position:0px -50px;width:18px;height:18px;overflow:hidden;*zoom:1;float:left;margin-right:6px;}
.hui_radioinput .hui_radioinput_text{float:left;}
.hui_radioinput_checked .hui_radioinput_icon{background-image:url(/static/img/hui_radioinput.png);background-repeat:no-repeat;background-position:0px 0px;width:18px;height:18px;overflow:hidden;float:left;margin-right:6px;}
.hui_radioinputgroup{overflow:hidden;float:left;}
.hui_checkbox .hui_checkbox_label{}
.hui_checkbox .hui_checkbox_label a{font-size:14px;}
.hui_checkbox .hui_checkbox_icon{font-family:simsun;margin:1px 10px 0 0;float:left;border:1px solid #d9d9d9;color:#1ba8eb;text-indent:-20px;font-size:15px;font-style:normal;line-height:1.1em;width:16px;height:16px;cursor:pointer;overflow:hidden;}
.hui_checkbox .hui_checkbox_label{color:#666666;font-size:14px;line-height:20px;float:left;padding-left:0px;cursor:pointer;}
.hui_checkbox .hui_checkbox_icon{visibility:visible;color:#68bf4a;text-indent:-100px;}
.hui_checkbox_checked .hui_checkbox_icon{visibility:visible;color:#68bf4a;text-indent:4px;}
.hj001_login_box .hui_checkbox .hui_checkbox_icon{visibility:visible;color:#68bf4a;text-indent:-100px;}
.hj001_login_box .hui_checkbox_checked .hui_checkbox_icon{visibility:visible;color:#68bf4a;text-indent:4px;}

</style>
<script type="text/javascript">
'use strict';
var form;

function showTestResult() {
    form.hide();
    alert();
    hui.g('subject_index').innerHTML = '1';
    
    
}

window.onload = function(){
    // subject_add
    hui.Control.init(hui.g('subject_add'));
    form = hui.Control.getByFormName('form');
    form.initSubject = function(){
        Requester.get('/ue_api/internal/get_next_question', {
            onsuccess: function (result) {
                if (result && !result[0] && result[1]) {
                    var data = result[1];
                    data.atcid = data._id;
                    data.index2 = data.index1 = data.index;
                    if (data.test_sn) {
                        hui.util.setCookie('test_sn', data.test_sn);
                    }
                    
                    form.setValueByTree(data);

                    form.getByFormName('content').disposeChild();
                    //var content = form.getByFormName('content').getMain();
                    for (var i in data.content) {
                        data.content[i].index = i;
                        form.addOption(data.content[i]);
                    }
                }
                else {
                    showTestResult();
                }
            }
        });

    };

    form.addOption = function (obj) {
        var content = form.getByFormName('content').getMain(),
            list,
            index;
        obj = obj || {};
        if (!obj.index) {
            var list = hui.c('td_index');
            obj.index = 1;
            for (var i=0,len=list.length; i<len; i++) {
                index = parseInt(list[i].innerHTML);
                if (index >= obj.index) {
                    obj.index = index + 1;
                }
            }
        }
        var tpl = 
            '<li class="tr_row" id="content#{index}" ui="type:\'Panel\',formName:\'#{index}\',isFormItem: true">' +
            '    <div ui="type:\'Label\',id:\'content#{index}\'">#{content}</div>' +
            '    <span class="td_index">#{index}</span>' +
            '    <div ui="type:\'Checkbox\',formName:\'correct\',id:\'correct#{index}\',value:\'yes\',checked:\'#{correct}\'"></div>' +
            '</li>';
        hui.util.appendHTML(content, hui.format(tpl, obj));
        hui.Control.create(hui.g('content'+obj.index));
    };
    form.removeOption = function (index) {
        var content = form.getByFormName('content');
        content.getByFormName(index).dispose();

    };
    form.removeAllOption = function () {
        var content = form.getByFormName('content'),
            option,
            main = content.getMain();
        var list = hui.c('td_index');
        for (var i=0,len=list.length; i<len; i++) {
            index = parseInt(list[i].innerHTML);
            option = content.getByFormName(i);
            if (option) {
                option.dispose();
            }
        }
        main.index = 0;
    };
    

    var submit = form.getByFormName('subject_nxt');
    submit.onclick = function () {
        var data = hui.Control.getByFormName('form').getParamMap();
        data.content = JSON.stringify(data.content);
        data.test_sn = hui.util.getCookie('test_sn');
        
        if (data.content.indexOf('yes') !== -1) {

            Requester.get('/ue_api/internal/save_next_question', {
                data: data,
                onsuccess: function (err, result) {
                    form.initSubject();
                }
            });
        }
        else if (window.confirm('友情提示：您尚未选择任何答案，确定跳过该题目吗')) {
            subject_skip.onclick();
        }
    };

    var subject_pre = form.getByFormName('subject_pre');
    subject_pre.onclick = function () {
        var data = {};
        data.index = parseInt(hui.g('subject_index').innerHTML, 10) - 1;
        Requester.get('/ue_api/internal/save_next_question', {
            data: data,
            onsuccess: function (err, result) {
                // form.getByFormName('subject_nxt').setDisabled(false);
                form.initSubject();
            }
        });
    };

    var subject_skip = form.getByFormName('subject_skip');
    subject_skip.onclick = function () {
        var data = {};
        data.index = parseInt(hui.g('subject_index').innerHTML, 10) + 1;
        Requester.get('/ue_api/internal/save_next_question', {
            data: data,
            onsuccess: function (err, result) {
                // form.getByFormName('subject_nxt').setDisabled(false);
                form.initSubject();
            }
        });
    };

    

    form.initSubject();
    form.show();

};
//-->
</script>

</head>

<body class="page" style="">
<!--target:test-->
<div id="subject_add" class="subject_test">
<!--target:test-->

    <div class="subject_box" ui="type:'BoxPanel',formName:'form'">
        <div class="subject_action">
            <input type="hidden" ui="type:'TextInput',formName:'atcid'" />
            <input type="hidden" ui="type:'TextInput',formName:'index'" />
            <a href="javascript:" class="subject_end" ui="type:'Button',formName:'subject_end'">结束测试</a>
            <a style="display:none;" href="javascript:" class="subject_pre" ui="type:'Button',formName:'subject_pre'">上一题</a>
            <button class="subject_nxt" ui="type:'Button',formName:'subject_nxt'" tabindex="100">提 交</button>
        </div>
        <h3 class="form_title"> 第 <span id="subject_index" ui="type:'Label',formName:'index1'">1</span> 题 <span class="sub">（共 <span id="subject_sum" ui="type:'Label',formName:'sum'">100</span> 题）</span></h3>
        <div class="form_content">
            <div class="subject_title"><span ui="type:'Label',formName:'index2'">1</span>、<span ui="type:'Label',formName:'title'"></sapn></div>
            <ol class="subject_option" ui="type:'Panel',formName:'content',isFormItem: true">
            </ol>
            <div style="text-align: right;"><a href="javascript:" class="subject_skip" ui="type:'Button',formName:'subject_skip'">跳 过</a></div>
        </div>

    </div>
</div>




</body>

</html>
