<script src="../src/hui.js"></script>
<script>
    'use strict';
//   __  __   __  __    _____   ______   ______   __  __   _____     
//  /\ \/\ \ /\ \/\ \  /\___ \ /\__  _\ /\  _  \ /\ \/\ \ /\  __`\   
//  \ \ \_\ \\ \ \ \ \ \/__/\ \\/_/\ \/ \ \ \/\ \\ \ `\\ \\ \ \ \_\  
//   \ \  _  \\ \ \ \ \   _\ \ \  \ \ \  \ \  __ \\ \ . ` \\ \ \ =__ 
//    \ \ \ \ \\ \ \_\ \ /\ \_\ \  \_\ \__\ \ \/\ \\ \ \`\ \\ \ \_\ \
//     \ \_\ \_\\ \_____\\ \____/  /\_____\\ \_\ \_\\ \_\ \_\\ \____/
//      \/_/\/_/ \/_____/ \/___/   \/_____/ \/_/\/_/ \/_/\/_/ \/___/ 
//                                                                   
//                                                                   

/**
 * @name 按钮控件
 * @public
 * @author wanghaiyang
 * @date 2014/05/05
 * @param {Object} options 控件初始化参数.
 */
hui.define('hui_slide', ['hui@0.0.1', 'hui_draggable'], function () {

    hui.Slide = function (options, pending) {
        hui.Slide.superClass.call(this, options, 'pending');

        // 类型声明，用于生成控件子dom的id和class
        this.type = 'slide';
        this.minValue = this.minValue === undefined ? 0   : Number(this.minValue);
        this.maxValue = this.maxValue === undefined ? 100 : Number(this.maxValue);
        this.tickStep = this.tickStep === undefined ? 1   : Number(this.tickStep);

        //进入控件处理主流程!
        if (pending != 'pending') {
            this.enterControl();
        }
    };

    hui.Slide.prototype = {
        getMainTpl: function(){
            var tpl = 
                '<div class="hui_slide_layer">' +
                '    <div class="hui_slide_min">0</div>' +
                '    <div class="hui_slide_max">20</div>' +
                '    <div class="hui_slide_scrollbar">' +
                '        <div class="hui_slide_inner">&nbsp;</div>' +
                '    </div>' +
                '    <div class="hui_slide_ticks"></div>' +
                '    <div class="hui_slide_percent"></div>' +
                '    <div class="hui_slide_handle"></div>' +
                '</div>' +
                '<div style="clear:both; overflow:hidden; font-size:0px;line-height:0px;height:1px;">&nbsp;</div>';
                return tpl;
        },
        getTickTpl: function(){
            var tpl = 
                '<div class="hui_slide_unit" style="left:#{1};">' +
                '    <span class="hui_slide_line">|</span>' +
                '    <span class="hui_slide_num">#{0}</span>' +
                '</div>';
            return tpl;
        },
        /**
         * @name 渲染控件
         * @public
         */
        render: function () {
            hui.Slide.superClass.prototype.render.call(this);
            var me = this,
                main = me.getMain(),
                tickTpl,
                tickList,
                width;


            me.setInnerHTML(me, me.getMainTpl());
            if (me.ticks) {
                tickTpl = me.getTickTpl();
                tickList = [];
                for (var i=me.minValue; i<=me.maxValue; i+=me.tickStep) {
                    tickList.push(i);
                }

                width = hui.cc('hui_slide_layer', main).offsetWidth;



                for (var i=0,len=list.length; i<len; i++) {
                    
                }
            }

            // 设置disabled
            me.setDisabled(!!me.disabled);
        },
        initBehavior: function(){
            var me = this,
                main = me.getMain();
            
            hui.Draggable(hui.cc('hui_slide_handle', main), {
                preventDefault: true,
                move: function(){
                    if (this.moving) {return;}
                    this.moving = true;
                    var dx = this.nowPoint.x-this.startPoint.x;
                    var left = this.oldPoint.left + dx;
                    left = left < 0 ? 0 : (left > 282 ? 282 : left);
                    document.getElementById('log').innerHTML = parseInt(left*100/282, 10);
                    this.elem.style.left = left + 'px';
                    hui.cc('hui_slide_inner', main).style.width = left + 'px';
                    
                    this.moving = false;
                },
                revert: false
            });
        },
        // onmove事件
        onmove: new Function()
        
    };

    // hui.Slide 继承了 hui.Control 
    hui.inherits(hui.Slide, hui.Control);

    hui.util.importCssString(
        '.hui_slide {padding-left: 20px;}' +
        '.hui_slide .hui_slide_min{position:absolute;z-index:1;right:100%;padding-right:6px;margin-top:-6px;}' +
        '.hui_slide .hui_slide_max{position:absolute;z-index:1;left:100%;padding-left:6px;margin-top:-6px;}' +
        '.hui_slide .hui_slide_layer{position:relative;z-index:1;width:300px;}' +
        '.hui_slide .hui_slide_scrollbar{border:1px solid #bbb;background-color:#d9d7cb;border-radius:3px;position:relative;z-index:1;}' +
        '.hui_slide .hui_slide_inner{width:100%;height:5px;background-color:#fe6502;border-radius:3px;}' +
        '.hui_slide .hui_slide_handle{height:16px;width:16px;position:absolute;z-index:1;left:190px;top:-5px;cursor:pointer;border:1px solid #99968f;background-color:#efefe7;border-radius:5px;}' +
        '.hui_slide .hui_slide_percent{}' +
        '.hui_slide .hui_slide_ticks{height:40px;}' +
        '.hui_slide .hui_slide_ticks .hui_slide_unit{position:absolute;z-index:1;}' +
        '.hui_slide .hui_slide_ticks .hui_slide_line{display:block;color:transparent;border-left:1px solid #999;height:9px;}' +
        '.hui_slide .hui_slide_ticks .hui_slide_num{display:block;margin-left:-3px;}'
    );

});

</script>
<!-- http://www.egrappler.com/free-multi-node-range-data-slider-jqslider/ -->



<div id="slide">
    <div ui="type:'Slide',id:'sss'"></div>
</div>
<div id="log"></div>

<script>
window.onload = function(){
     

     hui.Control.init(hui.g('slide'));
};


</script>
