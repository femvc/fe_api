<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Ebbinghaus Intelligent Remember [v1.0]</title>
<link rel="stylesheet" type="text/css" href="main.css">

<style>

</style>
<script type="text/javascript">
'use strict';
var form;

function showTestResult() {
    Requester.get('/ue_api/internal/get_rank', {
        data: {
            test_id: hui.util.getCookie('test_id')
        },
        onsuccess: function (result) {
            // form.getByFormName('subject_nxt').setDisabled(false);
            if (result && result[1]) {
                var data = result[1];
                if (data.question) {
                    hui.g('subject_index').innerHTML = '1';
                    data.rate = Math.round(100 * data.index / (data.sum + 0.001));
                    data.time = Math.ceil((hui.util.parseDate(data.time_end).getTime() - hui.util.parseDate(data.time_start).getTime()) / 60000);
                    data.question_count = data.question.length;
                    hui.g('result_chart').style.width = data.rate * 4 + 'px';
                    hui.Control.getByFormName('result').setValueByTree(data).show();
                }
                else {
                    console.log('Warning: Test not finish')
                }
            }
        }
    });
}

function showEvaluateReport() {
    Requester.get('/ue_api/internal/get_rank', {
        data: {
            test_id: hui.util.getCookie('test_id')
        },
        onsuccess: function (result) {
            // form.getByFormName('subject_nxt').setDisabled(false);
            if (result && result[1]) {
                var data = result[1];
                if (data.question) {
                    hui.Control.getByFormName('candidate').hide();
                    hui.Control.getByFormName('report').setValueByTree(data).show();
                    
                    var skill_list = hui.Control.getByFormName('skill_list');
                    var datasource = [
                        {index: 1, 'skill': 'HTML',      'correct': 22,'score': 22},
                        {index: 2, 'skill': 'CSS',       'correct': 22,'score': 22},
                        {index: 3, 'skill': 'JS',        'correct': 22,'score': 22},
                        {index: 4, 'skill': 'DOM',       'correct': 22,'score': 22},
                        {index: 5, 'skill': 'HTML5/CSS3','correct': 22,'score': 22},
                        {index: 8, 'skill': 'Backend',   'correct': 22,'score': 22},
                        {index: 6, 'skill': 'jQuery',    'correct': 22,'score': 22},
                        {index: 7, 'skill': 'PS',        'correct': 22,'score': 22}
                    ];
                    skill_list.datasource = datasource;
                    var score = [];
                    for (var i=0,len=datasource.length; i<len; i++) {
                        score.push(datasource[i].score);
                    }
                    skill_list.renderBody();
                    showResultChart(score);
                }
                else {
                    console.log('Warning: Test not finish')
                }
            }
        }
    });
}

function showResultChart(data){
    $('#skill_chart').highcharts({
        chart: {
            polar: true,
            type: 'line'
        },

        title: {
            text: '',
            y: -80
        },

        pane: {
            size: '78%',
            center: ['62%', '50%']
        },

        xAxis: {
            categories: ['HTML', 'CSS', 'JS', 'DOM', 'HTML5/CSS3', 'Backend', 'jQuery', 'PS'],
            tickmarkPlacement: 'on',
            lineWidth: 0
        },

        yAxis: {
            gridLineInterpolation: 'polygon',
            lineWidth: 0,
            min: 0
        },

        tooltip: {
            shared: true,
            pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f}</b><br/>'
        },

        legend: {
            align: 'right',
            verticalAlign: 'top',
            y: 0,
            x: 0,
            layout: 'vertical'
        },

        series: [{
            name: '中级水平',
            data: [70, 70, 60, 65, 40, 20, 60, 60],
            pointPlacement: 'off'
        }, {
            name: '高级水平',
            data: [80, 80, 75, 80, 65, 50, 70, 75],
            pointPlacement: 'off'
        }, {
            name: '架构师　',
            data: [95, 95, 95, 95, 80, 80, 85, 80],
            pointPlacement: 'off'
        }, {
            name: '目前级别',
            data: data ? data : [43, 19, 60, 35, 17, 10, 10, 17],
            pointPlacement: 'off'
        }]

    });
}

window.onload = function () {
    Requester.get('/ue_api/account/get_uid?rand=' + Math.random(), {
        onsuccess: function (result) {
            if (result && !result[0] && result[1]) {
                hui.g('uid').innerHTML = result[1];
            }
        }
    });
    hui.g('tid').innerHTML = hui.util.getCookie('test_id');
};

function startTest() {
    
    window.listTable = [{
        width: 100,
        title: '技能',
        sortable: true,
        field: 'index',
        content: function (item) {
            return item['skill'];
        }
    }, {
        width: 40,
        title: '答对',
        sortable: true,
        field: 'correct',
        content: function (item) {
            return item['correct'];
        }
    }, {
        width: 40,
        title: '得分',
        sortable: true,
        field: 'score',
        content: function (item) {
            return item['score'];
        }
    }];
    window.listData = [{
        'skill': 'html',
        'correct': 2,
        'score': 40
    }, {
        'skill': 'css',
        'correct': 2,
        'score': 40
    }];

    // subject_add
    hui.Control.init(hui.g('subject_add'));
    form = hui.Control.getByFormName('form');
    form.initSubject = function () {
        Requester.get('/ue_api/internal/get_next_question?rand=' + Math.random(), {
            onsuccess: function (result) {
                if (result && !result[0] && result[1]) {
                    var data = result[1];
                    if (data.atcid) {
                        data.atcid = data.atcid;
                        data.index2 = data.index1 = data.index;
                        data.title1 = data.title;
                        if (data.test_id) {
                            hui.util.setCookie('test_id', data.test_id);
                            hui.g('tid').innerHTML = data.test_id;
                        }

                        form.setValueByTree(data);

                        form.getByFormName('content').disposeChild();
                        //var content = form.getByFormName('content').getMain();
                        var list = data.options;
                        for (var i in list) {
                            list[i].index = i;
                            form.addOption(list[i]);
                        }
                    }
                }
            }
        });
    };

    form.addOption = function (obj) {
        var content = form.getByFormName('content').getMain(),
            list,
            index;
        obj = obj || {};
        if (!obj.index) {
            var list = hui.c('td_index');
            obj.index = 1;
            for (var i = 0, len = list.length; i < len; i++) {
                index = parseInt(list[i].innerHTML);
                if (index >= obj.index) {
                    obj.index = index + 1;
                }
            }
        }
        var tpl =
            '<li class="tr_row" id="content#{index}" ui="type:\'Panel\',formName:\'#{index}\',isFormItem: true">' +
            '    <div ui="type:\'Label\',id:\'content#{index}\'">#{content}</div>' +
            '    <span class="td_index">#{index}</span>' +
            '    <div ui="type:\'Checkbox\',formName:\'correct\',id:\'correct#{index}\',value:\'yes\',checked:\'#{correct}\'"></div>' +
            '</li>';
        hui.util.appendHTML(content, hui.format(tpl, obj));
        hui.Control.create(hui.g('content' + obj.index));
    };
    form.removeOption = function (index) {
        var content = form.getByFormName('content');
        content.getByFormName(index).dispose();

    };
    form.removeAllOption = function () {
        var content = form.getByFormName('content'),
            option,
            main = content.getMain();
        var list = hui.c('td_index');
        for (var i = 0, len = list.length; i < len; i++) {
            index = parseInt(list[i].innerHTML);
            option = content.getByFormName(i);
            if (option) {
                option.dispose();
            }
        }
        main.index = 0;
    };

    var submit = form.getByFormName('subject_nxt');
    submit.onclick = function () {
        var data = hui.Control.getByFormName('form').getParamMap();
        data.content = window.encodeURIComponent(JSON.stringify(data.content));

        if (data.content.indexOf('yes') !== -1) {
            subject_skip.onclick();
        }
        else if (window.confirm('友情提示：您尚未选择任何答案，确定跳过该题目吗')) {
            subject_skip.onclick();
        }
    };
    var subject_skip = form.getByFormName('subject_skip');
    subject_skip.onclick = function () {
        var data = hui.Control.getByFormName('form').getParamMap();
        data.content = window.encodeURIComponent(JSON.stringify(data.content));
        data.test_id = hui.util.getCookie('test_id');

        saveTestResult(data);
    };

    var subject_pre = form.getByFormName('subject_pre');
    subject_pre.onclick = function () {
        var data = {};
        data.index = parseInt(hui.g('subject_index').innerHTML, 10) - 1;

        saveTestResult(data);
    };

    function saveTestResult(data) {
        Requester.get('/ue_api/internal/save_next_question', {
            data: data,
            onsuccess: function (result) {
                // form.getByFormName('subject_nxt').setDisabled(false);
                if (result && result[1] && result[1][0] && result[1][0].index) {
                    form.initSubject();
                }
                else {
                    hui.Control.getByFormName('form').hide();
                    showTestResult();
                }
            }
        });
    }

    var result = hui.Control.getByFormName('result');
    result.getByFormName('result_nxt').onclick = function () {
        hui.Control.getByFormName('result').hide();
        hui.Control.getByFormName('candidate').show();
    };

    var candidate = hui.Control.getByFormName('candidate');
    candidate.getByFormName('candidate_nxt').onclick = function () {
        if (candidate.validate()) {
            var data = candidate.getParamMap();
            data.test_id = hui.util.getCookie('test_id');
            Requester.get('/ue_api/internal/update_rank', {
                data: data,
                onsuccess: function (result) {
                    // form.getByFormName('subject_nxt').setDisabled(false);
                    if (result && !result[0]) {
                        showEvaluateReport();
                    }
                }
            });
        }
    };
    // hui.Control.getByFormName('report').show();

    hui.Validator.setRule('career', {
        'validate': function (text) {
            if (text === null || text === undefined || text === '') {
                return 1;
            }
            return 0;
        },
        'noticeText': {
            1: '不能为空'
        }
    }, 'force');
    hui.Validator.setRule('annual', {
        'validate': function (text) {
            if (text === null || text === undefined || text === '') {
                return 1;
            }
            return 0;
        },
        'noticeText': {
            1: '不能为空'
        }
    }, 'force');
};
//-->
</script>

</head>

<body style="" onload="startTest()">
<!--.page>.page_head>.logo^+.page_body>h1.test_title{你想知道自己前端技术实力排名吗？}+.test_desc{2014年，北京、上海、广州的互联网公司已超过30,000家，其中前端开发人员已超过100,000人，想知道你自己技术实力的排名吗}+.test_btn{立即测试}^+.page_foot{2014-10-17}-->
<div class="page">
    <div class="page_head">
        <div class="link" style="text-align:right;">
            <a target="_blank" href="/ue_api/internal/get_papers">/ue_api/internal/get_papers</a> 
            <a target="_blank" href="/ue_api/internal/get_results">/ue_api/internal/get_results</a> 
            <a href="admin.htm">Dashboard</a>  uid: <span id="uid"></span> <br/>test_id: <span id="tid"></span>
        </div>
        <div class="logo">UED</div>
    </div>
    <div class="page_body">
        <div class="page_body_padding">&nbsp;</div>
        <h1 class="test_title"><span style="display:none">你想知道自己前端技术实力排名吗？</span><img alt="你想知道自己前端技术实力排名吗？" src="img/title_bg.png" width="55%" /></h1>
        <div class="test_desc">2014年，北京、上海的互联网公司已超过3,000家，其中前端开发人员已超过100,000人，<br/>你想知道自己技术实力的排名吗</div>
        <div class="test_btn" onclick="form.show();form.initSubject();">立即测试</div>
    </div>
    <div class="page_foot">&nbsp;&copy; FECampus 2014</div>

    <div id="subject_add" class="subject_test">
        <div class="subject_box" ui="type:'BoxPanel',formName:'form'" style="display:none">
            <div class="subject_action">
                <input type="hidden" ui="type:'TextInput',formName:'atcid'" />
                <input type="hidden" ui="type:'TextInput',formName:'title'" />
                <input type="hidden" ui="type:'TextInput',formName:'index'" />
                <a href="javascript:" class="subject_end" ui="type:'Button',formName:'subject_end'">结束测试</a>
                <a style="display:none;" href="javascript:" class="subject_pre" ui="type:'Button',formName:'subject_pre'">上一题</a>
                <button class="subject_nxt" ui="type:'Button',formName:'subject_nxt'" tabindex="100">提 交</button>
            </div>
            <h3 class="form_title"> 第 <span id="subject_index" ui="type:'Label',formName:'index1'">1</span> 题 <span class="sub">（共 <span id="subject_sum" ui="type:'Label',formName:'sum'">100</span> 题）</span></h3>
            <div class="form_content">
                <div class="subject_title">
                    <span ui="type:'Label',formName:'index2'">1</span>、<span ui="type:'Label',formName:'title1'"></span>
                </div>
                <ol class="subject_option" ui="type:'Panel',formName:'content',isFormItem: true">
                </ol>
                <div style="text-align: right;"><a href="javascript:" class="subject_skip" ui="type:'Button',formName:'subject_skip'">跳 过</a></div>
            </div>

        </div>

        <div class="result_box" ui="type:'BoxPanel',formName:'result'" style="display:none">
            <div class="box_content">
                <div class="result_score">成绩 <b class="score" ui="type:'Label',formName:'score'">84</b> <span class="score_unit">分</span></div>
                <div class="result_correct">答对 <b class="correct" ui="type:'Label',formName:'correct'">40</b> 题 （共 <b class="correct" ui="type:'Label',formName:'question_count'">40</b> 题） </div>
                <div class="result_time">耗时 <b class="time" ui="type:'Label',formName:'time'">40</b> 分钟</div>
                <div class="result_chart_bg"><div class="result_chart" id="result_chart">&nbsp;</div></div>
                <div class="result_rate">您打败了<b class="rate"><span ui="type:'Label',formName:'rate'">64</span>%</b>的挑战者!</div>
                <div class="result_tip">点击“下一步”继续进行评估</div>
                <button class="result_nxt" ui="type:'Button',formName:'result_nxt'" tabindex="100">下一步</button>
            </div>
        </div>
        <div class="candidate_box" ui="type:'BoxPanel',formName:'candidate',size:{width:'440px',height: '400px'}" style="display:none">
            <div class="box_content">
                <div class="row_item row_career">
                    <div class="title">请选择您的工作年限：</div>
                    <div ui="type:'Dropdown',formName:'career',placeholder:'--请选择--',rule:'not_empty',autoHideError:true,options:[
                        {value:'1',text:'1年'},{value:'2',text:'2年'},{value:'3',text:'3年'},{value:'4',text:'4年'},
                        {value:'5',text:'5年'},{value:'6',text:'6年'},{value:'7',text:'7年'},{value:'8',text:'8年'},
                        {value:'9',text:'9年'},{value:'10+',text:'10+'}],size:{width:230}"></div>
                </div>
                <hr class="clearfix" />
                <div class="row_item row_package">
                    <div class="title">请选择您目前年薪档位：</div>
                    <div ui="type:'Dropdown',formName:'annual',placeholder:'--请选择--',rule:'not_empty',autoHideError:true,options:[
                        {value:'5',text:'  &nbsp;5万'},{value:'10',text:' 10万'},{value:'15',text:' 15万'},
                        {value:'20',text:' 20万'},{value:'25',text:' 25万'},{value:'30',text:' 30万'},
                        {value:'35',text:' 35万'},{value:'40',text:' 40万'},{value:'45',text:' 45万'},
                        {value:'50',text:' 50万'},{value:'55',text:' 55万'},{value:'60',text:' 60万'},
                        {value:'75',text:' 75万'},{value:'80',text:' 80万'},{value:'85',text:' 85万'},
                        {value:'90',text:' 90万'},{value:'100+',text:'100+'}],size:{width:230}"></div>
                </div>
                <hr class="clearfix" />
                <div class="candidate_tip">点击“下一步”查看您的 <b class="strong">薪资收入</b> 提升空间!</div>
                <button class="candidate_nxt" ui="type:'Button',formName:'candidate_nxt'" tabindex="100">下一步</button>
            </div>
            
        </div>
        <div class="report_box" ui="type:'BoxPanel',formName:'report',size:{width:'530px'}" style="display:none">    
            <div class="box_content">
                <div class="fe_level" style="display:none;">
                初级前端工程师 0-35        1000 <br/>
                中级前端工程师 35-55       200 <br/>
                高级前端工程师 50-70       300 <br/>
                前端架构师     65-85       10 <br/>
                资深前端架构师 80-100      1  <br/>  
                </div>                  
                <div class="result_level">目前级别 <b class="strong" id="level">高级前端工程师</b> <b class="b">&nbsp;</b>目前年薪 <b class="b">20万</b></div>
                <div class="effect" onmousedown="hui.c('spam', this).remove()">预计经过 <b class="b">前端训练营</b> 的 <b class="strong">前端架构师特训</b>，您的能力<br/>能够达到 <b class="strong" id="level_nxt">前端架构师</b> 级别，薪资可以提高 <b class="b">6~12</b>万，达到 <b class="b">26~34</b>万/年以上。 </div>
                <div class="effect">咨询预约：<b class="tel">189<span class="spam" style="display:none;">8</span>18<span class="spam" style="display:none;">8</span>12<span class="spam" style="display:none;">8</span>64<span class="spam" style="display:none;">8</span>28</b> <b class="b">&nbsp;</b>微信：<b class="tel">fe<span class="spam" style="display:none;">8</span>campus</b></div>
  
                <div class="result_title"> 详细测评报告：</div>
                <div class="result_detail">
                    <div id="skill_chart" style="min-width: 310px; max-width: 310px; height: 300px; position: absolute;z-index:9999;margin-left: 200px;"></div>
                    <div ui="type:'Table',formName:'skill_list',fields:'&listTable',datasource:'&listData',sortable:true,size:{width:200}"></div>
                </div>    

            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="asset/asset.js"></script>
</body>

</html>
